# 患者向け予約システム開発用プロンプト

以下の指示を v0.app や他の生成 AI に渡し、患者向けの予約フロントエンド／ワークフローを構築してください。歯科医院用ダッシュボード（本リポジトリ）のレイアウトは変更しません。

## これは何？（かんたんな説明）
- **目的**: 既に完成している管理画面の UI を一切変更せず、別リポジトリで患者向け予約フォームを作るための依頼文テンプレートです。
- **使い方**: このファイルの内容を丸ごと別の開発者や生成 AI に渡せば、どの API を使い、どのような制約で実装するかが共有できます。
- **ポイント**: 予約関連の処理は `/api/reservations` など既存の HTTP API を必ず経由し、ブラウザから Supabase の Service Role Key を触らないようにする、という方針を明確にしています。

まずはこの概要を読み、「患者側アプリを作るときの指示書」であることを理解した上で、以降の詳細セクションを参照してください。

---

## 依頼内容
- 目的: 既存の歯科医院管理ダッシュボード（Next.js App Router）と連携する「患者向け予約システム」を実装する。
- 条件: 管理画面側の UI レイアウトには一切手を加えない。患者フロントは `/api/reservations` および `/api/patients`、`/api/staff` の HTTP API を利用して予約を登録・変更する。
- 技術スタックの推奨: Next.js (App Router) + Tailwind CSS + React Hook Form など。Supabase へは直接アクセスせず、必ず提供済み API を fetch する。

## 接続先 API
1. `GET /api/staff`
   - スタッフ一覧を取得し、患者が担当医を選択できるようにする。
2. `GET /api/reservations?date=YYYY-MM-DD`
   - 既存の予約状況を日別に取得し、重複を避けた時間帯選択 UI を構築する。
3. `POST /api/reservations`
   - フォーム送信で予約を作成。`patient_id` が無い場合は `patient` 情報（氏名、メール、電話番号など）を JSON で送るとサーバーが自動で患者レコードを作成する。
4. `PATCH /api/reservations/:id`
   - 患者が後から予約内容を変更できるようにする場合に利用。
5. `DELETE /api/reservations/:id`
   - キャンセル操作。現在の実装では `status` を `"cancelled"` に更新するソフトデリート方式。

すべての API 呼び出しには HTTP Basic 認証ヘッダーが必要：
```
Authorization: Basic base64("${DASHBOARD_BASIC_AUTH_USER}:${DASHBOARD_BASIC_AUTH_PASSWORD}")
```

## バリデーション & フォーマット
- `date`: `YYYY-MM-DD`
- `start_time` / `end_time`: `HH:MM` (24 時間表記)
- `treatment_type`: 例 `"初診"`, `"定期検診"`, `"ホワイトニング"`
- 予約時間帯はサーバー側で重複チェック済みだが、フロントでも基本的な検証（終了時刻 > 開始時刻など）を行う。

## 必須要素
- 予約フォーム: 来院目的、希望日時（カレンダー or 時間帯セレクター）、患者情報（氏名・メール・電話番号）を入力。
- 予約確認画面: 送信前に内容を確認し、確定後にサクセスメッセージを表示。
- 変更／キャンセル: 予約番号と認証情報（メール + 認証コードなど）で本人確認したうえで `PATCH`/`DELETE` を利用。
- アクセシビリティ: 入力支援、エラーメッセージ、モバイル対応。

## セキュリティ
- すべての fetch リクエストはサーバー側（Route Handler や API Routes）で実行し、Basic 認証資格情報や API レスポンスを安全に扱う。
- ブラウザ直送が必要な場合は Next.js のサーバーアクションや Edge Middleware で資格情報を隠蔽する。

## 成果物
- `app/(patient)/` 以下に患者向けの UI ページ群を作成。
- `components/patient/` 以下にフォーム・確認ダイアログなどの再利用コンポーネントを配置。
- 必要な型定義は `types/api.ts` を再利用し、`ReservationPayload` や `ReservationResponse` を import して一貫性を保つ。
- E2E もしくは統合テストで `/api/reservations` へのリクエストが成功することを確認。

---

このプロンプトをそのまま開発者／生成 AI に渡し、患者向け予約システムの制作を依頼してください。既存の管理画面のレイアウトには一切触れないよう明記しています。
